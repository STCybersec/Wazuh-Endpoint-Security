#!/bin/bash
# summarize_vulns.sh
# ---------------------------------------------------------
# Description:
#   Summarizes High and Critical vulnerabilities using
#   Wazuh API + jq.
#
# Usage:
#   chmod +x summarize_vulns.sh
#   ./summarize_vulns.sh
#
# Requirements:
#   jq must be installed.
# ---------------------------------------------------------

API_URL="https://<WAZUH-MANAGER-IP>:55000/vulnerability"
AUTH="wazuh:yourpassword"
OUT_FILE="high_vulns.json"

echo "Fetching vulnerabilities from Wazuh API..."

# --- Fetch Vulnerability Data ---
curl -s -k -u $AUTH $API_URL | jq '.data.vulnerabilities[] | select(.severity=="High" or .severity=="Critical")' > "$OUT_FILE"

echo "-------------------------------------------------"
echo "   HIGH & CRITICAL VULNERABILITIES SUMMARY"
echo "-------------------------------------------------"

jq '. | {name: .name, cve: .cve, severity: .severity, affected_component: .package.name}' "$OUT_FILE"

echo "-------------------------------------------------"
echo "Summary saved to: $OUT_FILE"
